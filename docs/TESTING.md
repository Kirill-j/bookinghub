# Тестирование backend-части BookingHub

## Общая информация

В проекте BookingHub backend реализовано модульное тестирование
ключевых слоёв приложения:

- service (бизнес-логика)
- repo (работа с базой данных)
- handler (HTTP-обработчики)

Тестирование выполнено с использованием стандартного инструментария Go.

---

## Используемые инструменты

- `testing` — стандартный пакет Go для unit-тестов
- `sqlmock` — эмуляция SQL-базы данных
- `net/http/httptest` — тестирование HTTP-обработчиков
- `go test -cover` — анализ покрытия кода тестами
- GitHub Actions — автоматический запуск тестов в CI

---

## Структура тестов

### 1. Service-тесты (`internal/service`)

Тестируется бизнес-логика без зависимости от HTTP и базы данных.

Проверяется:
- валидация временных интервалов бронирования
- запрет бронирования в прошлом
- минимальная длительность брони
- обнаружение конфликтов бронирований

Покрытие:
- более 95%

---

### 2. Repo-тесты (`internal/repo`)

Тестируется работа с базой данных через `sqlmock`.

Проверяется:
- корректность SQL-запросов
- правильная обработка ошибок
- CRUD-операции для пользователей, объявлений, бронирований и категорий

Особенности:
- реальные SQL-запросы не выполняются
- база данных полностью эмулируется

---

### 3. Handler-тесты (`internal/handler`)

Тестируются HTTP-обработчики API.

Проверяется:
- корректность HTTP-статусов (200, 201, 400, 401, 403, 409)
- обработка авторизации и ролей
- работа JSON-запросов и ответов
- бизнес-правила (кто может подтверждать или отменять бронирование)

Используются:
- `httptest.NewRecorder`
- `httptest.NewRequest`
- подстановка пользователя через контекст

---

## Исключения из покрытия

Из покрытия тестами намеренно исключены следующие пакеты:

- `cmd/hash` — вспомогательная CLI-утилита
- `internal/db` — код миграций базы данных

Данные пакеты не содержат бизнес-логики приложения и не влияют
на корректность работы API.

---

## CI и автоматизация

Для проекта настроен GitHub Actions workflow:

- тесты запускаются при `push` и `pull request`
- используется Go версии 1.22
- автоматически считается покрытие тестами
- сборка считается успешной при покрытии ≥ 55%

---

## Запуск тестов локально

```bash
cd apps/backend
go test ./... -coverprofile=coverage.out
go tool cover -func=coverage.out
```

---

## Итог

Тестирование обеспечивает:
 - проверку ключевых сценариев работы приложения
 - защиту от регрессий
 - стабильную работу backend-части BookingHub