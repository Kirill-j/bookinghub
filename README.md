# BookingHub

**BookingHub** — учебный fullstack-проект для публикации объявлений (ресурсов) и бронирования по времени: переговорные, студии, оборудование и т.д.  
Пользователи могут регистрироваться как **Частное лицо** или **Компания**, размещать объявления и бронировать ресурсы.  
Владелец объявления подтверждает/отклоняет заявки на бронирование. Администратор управляет категориями.

---

## Содержание

- [Возможности](#возможности)
- [Роли и права](#роли-и-права)
- [Технологии](#технологии)
- [Структура репозитория](#структура-репозитория)
- [Быстрый старт](#быстрый-старт)
- [Переменные окружения](#переменные-окружения)
- [База данных, миграции, сиды](#база-данных-миграции-сиды)
- [Запуск Backend](#запуск-backend)
- [Запуск Frontend](#запуск-frontend)
- [Сценарии использования](#сценарии-использования)
- [API (эндпоинты)](#api-эндпоинты)
- [UI/страницы фронтенда](#uiстраницы-фронтенда)
- [Частые ошибки и решения](#частые-ошибки-и-решения)
- [Roadmap](#roadmap)

---

## Возможности

### Каталог и поиск
- Просмотр списка ресурсов (объявлений)
- Фильтры: категория, поиск по названию/локации, цена от/до
- Сортировка

### Объявления (ресурсы)
- Создание объявления (доступно всем авторизованным)
- Привязка объявления к владельцу (owner_user_id)
- Просмотр страницы ресурса и занятости по датам

### Бронирования
- Создание брони (PENDING)
- Отмена брони (ограничения по времени)
- Подтверждение/отклонение брони **только владельцем объявления** (или админом)
- Комментарий владельца к решению (approve/reject)

### Профиль
- Редактирование профиля: имя, email
- Смена пароля
- Удаление аккаунта (с каскадным удалением своих объявлений и связанных броней)
- Разделы профиля:
  - Мои объявления
  - Подтверждение брони (заявки на мои объявления)
  - Мои бронирования
  - Разместить объявление

### Админка
- Управление категориями (создание/редактирование — зависит от реализации на текущем этапе)

---

## Роли и права

В проекте используются роли:

- **INDIVIDUAL** — частное лицо  
- **COMPANY** — компания  
- **ADMIN** — администратор

Права:
- **Создание объявления**: любой авторизованный пользователь (INDIVIDUAL/COMPANY/ADMIN)
- **Подтверждение/отклонение брони**: только владелец объявления (owner_user_id) или ADMIN
- **Создание категорий**: только ADMIN
- **Просмотр каталога**: все пользователи (публично)
- **Создание брони**: любой авторизованный

---

## Технологии

### Backend
- Go
- chi (роутинг)
- sqlx (работа с БД)
- MySQL
- JWT auth
- Миграции SQL (каталог `migrations/`)

### Frontend
- React + react-router-dom
- Fetch API через небольшой клиент (`api/client`)
- CSS (единый стиль в `app.css`)

---

## Структура репозитория
Примерно так:
```dir
bookinghub/
    apps/
        backend/
            cmd/
                hash/
            internal/
                db/
                domain/
                handler/
                repo/
                service/
            migrations/
            main.go
        frontend/
            src/
                api/
                components/
                    ui/
                pages/
                    profile/
                styles/
                utils/
                package.json
    docs/
```

---

## Быстрый старт

### Требования
- Go (1.20+ желательно)
- Node.js (18+ желательно)
- MySQL 8.x (или совместимая MariaDB)
- Git

### 1) Клонировать репозиторий
```bash
git clone <your-repo-url>
cd bookinghub
```

### 2) Поднять MySQL и создать БД
Создай пустую базу:
```bash
CREATE DATABASE bookinghub CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3) Запуск Backend
```bash
cd apps/backend
go run .
```

### 4) Запуск Frontend
В новом терминале:
```bash
cd apps/frontend
npm install
npm run dev
```
Открывай приложение по адресу, который покажет dev-сервер (обычно http://localhost:5173).

---

## Переменные окружения
Backend читает `.env` (через `godotenv`), либо переменные окружения системы.

Пример `.env` для `apps/backend/.env`:

```env
PORT=8080

DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=
DB_NAME=bookinghub

JWT_SECRET=dev-secret
JWT_ACCESS_TTL_MIN=15
```

---

## База данных, миграции, сиды

При старте backend выполняет миграции из папки:

 - `apps/backend/migrations`

Там создаются таблицы и сид-данные (если у тебя сделано именно так).

Важно:
 - Если вы меняете схему (добавляете поля, ENUM и т.д.) — создавайте новую миграцию.
 - Если “вдруг” в таблицах появляются странные значения (например пустой status) — чаще всего проблема в старой БД/миграциях. В учебном проекте проще:
    1. удалить БД
    2. создать заново
    3. запустить backend (миграции применятся снова)

### Запуск Backend
Из `apps/backend`:

```bash
go run .
```

Backend поднимается на:

 - http://localhost:8080

Healthcheck:

 - GET /api/health -> ok

### Запуск Frontend
Из `apps/frontend`:

```bash
npm install
npm run dev
```

---

## Сценарии использования

### **Регистрация**
 1. Открыть страницу регистрации
 2. Ввести имя, email, пароль
 3. Выбрать тип аккаунта: INDIVIDUAL / COMPANY
 4. После регистрации выполняется авто-логин

### **Разместить объявление**
 - Профиль -> “Разместить объявление”
 - Заполнить категорию, название, локацию, цену, описание
 - Опубликовать

### **Забронировать ресурс**
 - Каталог -> открыть ресурс
 - Выбрать дату и время
 - Создать бронь -> статус `PENDING`

### **Подтвердить бронь (владелец объявления)**
 - Профиль -> “Подтверждение брони”
 - Указать комментарий (для каждой карточки отдельно)
 - Подтвердить или отклонить

 ---

## API (эндпоинты)

Ниже перечислены ключевые маршруты (фактические могут отличаться, если ты расширял проект — но это базовая карта).

### Public
 - `GET /api/health` — проверка сервера

 - `GET /api/categories` — список категорий

 - `GET /api/resources` — список ресурсов

 - `GET /api/resources/{id}/bookings?from=YYYY-MM-DD&to=YYYY-MM-DD` — занятость ресурса на дату

### Auth

`POST /api/auth/register`

body:
```json
{ "name": "...", "email": "...", "password": "...", "accountType": "INDIVIDUAL|COMPANY" }
```


`POST /api/auth/login`

body:
```json
{ "email": "...", "password": "..." }
```
 - `GET /api/auth/me` — текущий пользователь (JWT)
 - `PATCH /api/auth/me` — обновить имя/email
 - `POST /api/auth/password` — смена пароля
 - `DELETE /api/auth/me` — удалить аккаунт

### Resources (объявления)
 - `POST /api/resources` — создать ресурс (только авторизованные)
 - `GET /api/resources/my` — мои объявления (JWT)

### Bookings (бронирования)
 - `POST /api/bookings` — создать бронь (JWT)
 - `GET /api/bookings/my` — мои бронирования (JWT)
 - `POST /api/bookings/{id}/cancel` — отменить бронь (JWT, только владелец брони)
 - `GET /api/bookings/pending` — заявки на подтверждение (JWT, владелец объявлений видит только свои заявки — если реализовано так)
 - `PATCH /api/bookings/{id}/status` — подтвердить/отклонить бронь (JWT, только владелец объявления или ADMIN)

### Users
 - `GET /api/users/{id}` — публичная страница пользователя (имя/роль + доп. поля если добавишь)

### Admin
 - `POST /api/categories` — создание категории (ADMIN)

 ---

## UI/страницы фронтенда
### Публичные/основные
 - `/` — каталог
 - `/resources/:id` — страница ресурса
 - `/profile/*` — личный кабинет (внутри разделы)
 - `/users/:id` — публичная страница пользователя

### Профиль
Разделы внутри `/profile`:
 - `/profile` — "основной профиль" (редактирование, безопасность, опасная зона)
 - `/profile/listings` — мои объявления
 - `/profile/pending` — подтверждение брони
 - `/profile/bookings` — мои бронирования (+ отмена)
 - `/profile/new` — размещение объявления

---

## Частые ошибки и решения
### 1) “Статус пустой / не обновляется”
Обычно это:
 - старая БД без дефолтов
 - миграции применились не так, как ожидаешь

Решение:
 - удалить базу `bookinghub`
 - создать заново
 - запустить backend (миграции заново)

### 2) 404 на эндпоинты
Проверить:
 - backend запущен на правильном порту
 - фронт ходит туда же (прокси/база URL)
 - маршрут реально существует в `main.go`

### 3) После логина UI не обновляется до refresh

Почти всегда проблема в том, что `me` или `token` не обновляются сразу в state.
Решение: после логина сохранять token, обновлять `me` и триггерить загрузку публичных данных (`loadPublic`).

### 4) “Cannot add or update a child row: a foreign key constraint fails”

Это про внешние ключи в MySQL.
Чаще всего сиды вставляются в неверном порядке или owner_user_id ссылается на несуществующего пользователя.
Лечится исправлением сидов или пересозданием БД.

---

## Roadmap

Идеи для следующего этапа:

Телефон пользователя: хранение в БД, редактирование, показ владельца на карточках

---

## Лицензия

Учебный проект. Можно использовать как основу для собственного приложения, с указанием автора исходного кода.